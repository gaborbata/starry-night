<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Starry Night, inspired by the original screen saver known from Norton Commander">
<meta name="copyright" content="Copyright (c) 2021 Gabor Bata">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@gabor_bata">
<meta name="twitter:creator" content="@gabor_bata">
<meta property="og:title" content="Starry Night">
<meta property="og:description" content="Starry Night, inspired by the original screen saver known from Norton Commander">
<meta property="og:type" content="product">
<title>Starry Night</title>
<style type="text/css">
    body {
        background-color: #000;
        color: #ccc;
        margin: 0;
        padding: 0;
    }

    #wrapper {
        display: table;
        height: 100%;
        position: absolute;
        width: 100%;
    }

    #container {
        display: table-cell;
    }

    #footer {
      bottom: 0;
      height: 150px;
      left: 0;
      position: fixed;
      width: 100%;
      z-index: 1;
    }

    #dialog {
        background-color: #00c;  
        border: 4px double #0cc;
        font-family: monospace;
        font-size: 14px;
        font-weight: bold;
        text-align: center;
        margin: 20px auto;
        padding: 20px;
        width: 60%;
    }

    .star {
       background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAKCAMAAADByP1DAAAACVBMVEUAAACHiYb////0rNC2AAAAPUlEQVR42mMgBTAxEauQOC1MIABnQmkIwlSKpAVTM0IDIyOUgamQCQIgLCiBqYWwLZgOI+wXykOM8njBBADQJADFovle5QAAAABJRU5ErkJggg==');
       background-size: 100px 20px;
       height: 20px;
       image-rendering: pixelated;
       position: absolute;
       width: 20px;
    }

    .star-1 {
        background-position: 0 0;
    }

    .star-2 {
        background-position: -20px 0;
    }

    .star-3 {
        background-position: -40px 0;
    }

    .star-4 {
        background-position: -60px 0;
    }

    .star-5 {
        background-position: -80px 0;
    }
</style>
<div id="footer">
   <div id="dialog">
        Starry Night, inspired by the original screen saver known from Norton Commander<br>
        Copyright (c) 2021 Gabor Bata
   </div>
</div>
<div id="wrapper">
    <div id="container"></div>
</div>
<script>
{
    let STAR_DISAPPEAR = 2, STAR_BLOW_UP = 5;
    let container = document.querySelector('#container');
    let maxWidth, maxHeight;

    init();
    
    // re-initialize the page on screen resize
    window.addEventListener('resize', init);
   
    // hide footer
    setTimeout(() => document.getElementById('footer').style.display = 'none', 10000);
   
    /**
     * Initializes the stars for the current screen size.
     */
    function init() {
        maxWidth = Math.floor(container.clientWidth / 20);
        maxHeight = Math.floor(container.clientHeight / 20);
   
        // hide stars wich are initialized for a different screen size,
        // they will be cleaned up after reaching their end of lifetime
        document.querySelectorAll('.star').forEach(star => {
            star.removeAttribute('id');
            star.style.display = 'none';
        });

        for (let x = 0; x < maxWidth; x++) {
            for (let y = 0; y < maxHeight; y++) {
                if (Math.random() > 0.98) {
                    addStar(x, y);
                }
            }
        }
    }

    /**
     * Create and add a new star to the page.
     * @param {number} x - the x coordinate of the star
     * @param {number} y - the y coordinate of the star
     * @return {boolean} true if the star is added, or false if a star with the same id already exists
     */
    function addStar(x, y) {
        let id = `star-${x}-${y}`;
        if (!document.getElementById(id)) {
            let el = document.createElement('div');
            el.id = id;
            el.classList.add('star', 'star-1');
            el.style.left = `${x * 20}px`;
            el.style.top = `${y * 20}px`;
            container.appendChild(el);
            let animLen = Math.random() > 0.2 ? STAR_DISAPPEAR : STAR_BLOW_UP;
            let lifetime = Math.floor(Math.random() * 8000) + 2000;
            animate(el, 1, animLen, lifetime);
            return true;
        }
        return false;
    }

    /**
     * Animate the given star recursively.
     * @param {object} el - HTML element representing the star
     * @param {number} animIdx - the number of animation frame to display
     * @param {number} animLen - the length of animation, i.e. how many frames to display
     * @param {number} lifetime - the lifetime of the star before it disappears
     */
    function animate(el, animIdx, animLen, lifetime) {
        if (animIdx <= animLen) {
            setTimeout(() => {
                el.classList.add('star-' + (animIdx + 1));
                el.classList.remove('star-' + animIdx);
                animate(el, animIdx + 1, animLen, 150);
            }, lifetime);
        } else {
            // at the and of animation, remove the star
            container.removeChild(el);
            if (el.id) {
                // create a new star for each removed star in an empty position
                while(!addStar(Math.floor(Math.random() * maxWidth), Math.floor(Math.random() * maxHeight)));
            }
        }
    }
}
</script>
</html>
